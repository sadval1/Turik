<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Турнирная таблица</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; }
    select, input, button { margin: 5px; padding: 5px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #aaa; padding: 8px; text-align: center; }
    th { background-color: #eee; }
    .section { margin-top: 40px; }
    .winner { font-weight: bold; }
  </style>
</head>
<body>
  <h1>Warni-warni: Ввод результатов</h1>

  <form id="matchForm">
    <select id="player1" required></select>
    <input type="number" id="score1" placeholder="Счет 1" required />

    <select id="player2" required></select>
    <input type="number" id="score2" placeholder="Счет 2" required />

    <button type="submit">Добавить матч</button>
  </form>

  <div class="section">
    <h2>Турнирная таблица</h2>
    <table id="standings">
      <thead>
        <tr>
          <th>Игрок</th>
          <th>Игры</th>
          <th>Очки</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="section">
    <h2>Сыгранные матчи</h2>
    <ul id="matchList"></ul>
  </div>

  <script>
    const players = [
      "Коля", "Серёжа", "Андрей", "Макар",
      "Даня У.", "Макс", "Тимур", "Петя",
      "Женя Л", "Женя Ш", "Даня К", "Влад"
    ];

    function populatePlayerSelects() {
      const player1Select = document.getElementById("player1");
      const player2Select = document.getElementById("player2");
      players.forEach(name => {
        const option1 = new Option(name, name);
        const option2 = new Option(name, name);
        player1Select.appendChild(option1);
        player2Select.appendChild(option2);
      });
    }

    let matches = JSON.parse(localStorage.getItem("matches")) || [];

    document.getElementById("matchForm").addEventListener("submit", function(e) {
      e.preventDefault();

      const player1 = document.getElementById("player1").value;
      const score1 = parseInt(document.getElementById("score1").value);
      const player2 = document.getElementById("player2").value;
      const score2 = parseInt(document.getElementById("score2").value);

      if (!player1 || !player2 || player1 === player2 || isNaN(score1) || isNaN(score2)) return;

      // Проверка на повторный матч (в любом порядке)
      const alreadyPlayed = matches.some(
        m => (m.player1 === player1 && m.player2 === player2) ||
             (m.player1 === player2 && m.player2 === player1)
      );

      if (alreadyPlayed) {
        alert("Эти игроки уже сыграли между собой!");
        return;
      }

      matches.push({ player1, player2, score1, score2 });
      localStorage.setItem("matches", JSON.stringify(matches));

      this.reset();
      updateTable();
      updateMatchList();
    });

    function updateTable() {
      const table = {};
      matches.forEach(({ player1, player2, score1, score2 }) => {
        [player1, player2].forEach(p => {
          if (!table[p]) table[p] = { games: 0, points: 0 };
        });

        table[player1].games += 1;
        table[player2].games += 1;

        table[player1].points += score1;
        table[player2].points += score2;
      });

      const tbody = document.querySelector("#standings tbody");
      tbody.innerHTML = "";

      Object.entries(table)
        .sort((a, b) => b[1].points - a[1].points)
        .forEach(([player, stats]) => {
          const row = `<tr>
            <td>${player}</td>
            <td>${stats.games}</td>
            <td>${stats.points}</td>
          </tr>`;
          tbody.insertAdjacentHTML("beforeend", row);
        });
    }

    function updateMatchList() {
      const ul = document.getElementById("matchList");
      ul.innerHTML = "";

      if (matches.length === 0) {
        ul.innerHTML = "<li>Пока нет сыгранных матчей.</li>";
        return;
      }

      matches.forEach(({ player1, player2, score1, score2 }) => {
        const li = document.createElement("li");

        // Определяем победителя
        let p1 = player1, p2 = player2;
        if (score1 > score2) {
          p1 = `<span class="winner">${player1}</span>`;
        } else if (score2 > score1) {
          p2 = `<span class="winner">${player2}</span>`;
        }

        li.innerHTML = `${p1} ${score1} : ${score2} ${p2}`;
        ul.appendChild(li);
      });
    }

    // Инициализация
    populatePlayerSelects();
    updateTable();
    updateMatchList();
  </script>
</body>
</html>
